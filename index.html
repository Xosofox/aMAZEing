<!DOCTYPE html>
<html>
    <head>
        <title>aMAZEing</title>
    </head>
    <body>
        <h1>aMAZEing</h1>

        <script type="text/javascript">
            </script>

        <div id="mazecontainer">
            Walls: <select name="bgColor" id="bgColor"></select><br />
            Background: <select name="fgColor" id="fgColor"></select><br />
            Columns: <input name="COLS" id="COLS" type="text" size="4" value="20"><br />
            Rows: <input name="ROWS" id="ROWS" type="text" size="4" value="20"><br />
            
            <input type="checkbox" name="watch" id="watch"><label for="watch">Watch how maze is being generated</label>
            <input type="button" name="start" value="Generate" id="start"><br />
            <div id="status">Status: waiting for start</div>
            <canvas id="mazeview" width="200" height="200"></canvas>
        </div>

        <script type="text/javascript" src="js/lib/jquery.min.js"></script>
        <script type="text/javascript" src="js/lib/underscore-min.js"></script>
        <script type="text/javascript" src="js/lib/backbone-min.js"></script>

        <script type="text/javascript" src="js/models/Maze.js"></script>
        <script type="text/javascript" src="js/models/Cell.js"></script>
        <script type="text/javascript" src="js/views/MazeView.js"></script>

        <script type="text/javascript">
            var maze;
            var mazeView
            var htmlColors= ["aqua", "black", "blue", "fuchsia", "gray", "green", "lime", "maroon", "navy", "olive", "pink", "purple", "red", "silver", "teal", "white", "yellow"];
            var watcherInterval;
            $(document).ready(function () {
                var ROWS=1;
                var COLS=1;
                maze = new Maze({
                    rows:ROWS,
                    cols:COLS
                    //stepDelay:0
                });
                mazeView = new MazeView({
                    el: '#mazeview',
                    model:maze,
                    size:10,
                    border:1,
                    zoom: 1,
                    bgColorStyle: "black",
                    fgColorStyle: "pink"
                });

                for (var c=0;c<htmlColors.length;c++) {
                    $('#fgColor').append('<option style="color: '+htmlColors[c]+'" value="'+htmlColors[c]+'">'+htmlColors[c]+'</option>');
                    $('#bgColor').append('<option style="color: '+htmlColors[c]+'" value="'+htmlColors[c]+'">'+htmlColors[c]+'</option>');
                }
                $('#bgColor').val("black");
                $('#fgColor').val("pink");

                updateStatus=function() {
                    var u=maze.get("unvisited");
                    var cs=maze.get("cellStack");
                    $('#status').text("Status: "+u+" remaining, Stack "+cs.length);
                };

                $('#start').click(function() {

                    watcherInterval=setInterval(updateStatus,200);
                    if ($('#watch').is(':checked')) {
                        maze.set("stepDelay",0);
                    } else {
                        maze.set("stepDelay",-1);
                    }
                    ROWS=parseInt($('#ROWS').val());
                    if ((ROWS>0) && (ROWS<=200)) {
                        //
                    } else {
                        alert("Enter valid number of rows between 1 and 200");
                    }

                    COLS=parseInt($('#COLS').val());
                    if ((COLS>0) && (COLS<=200)) {
                        //
                    } else {
                        alert("Enter valid number of columns between 1 and 200");
                    }

                    maze.set({"rows":ROWS, "cols":COLS});
                    maze.reset();
                    maze.setStart([0,0]);
                    maze.setExit([ROWS-1,COLS-1]);
                    mazeView.options.fgColorStyle=$('#fgColor').val();
                    mazeView.options.bgColorStyle=$('#bgColor').val();
                    mazeView.render();
                    maze.set("readyCallback",function() {
                        clearInterval(watcherInterval);
                        $('#status').text("DONE!");
                    });
                    maze.startDigging([0,0]);
                });
            });
        </script>
    </body>
</html>
